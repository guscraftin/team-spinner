/* Thème académique technologique */
:root {
  --black: #000000;
  --white: #ffffff;
  --bg: #05070b;
  --bg-alt: #0b1118;
  --panel: #0f1620;
  --panel-alt: #14202b;
  --blue-1: #0077B6;
  --blue-2: #00B4D8;
  --blue-3: #48CAE4;
  --accent: var(--blue-2);
  --danger: #ff3d5a;
  --success: #48e1a5;
  --radius: 18px;
  --serif: 'Georgia', 'Times New Roman', serif;
  --sans: 'Inter', 'Segoe UI', system-ui, sans-serif;
  --mono: 'JetBrains Mono', 'Source Code Pro', monospace;
  --gradient-blue: linear-gradient(135deg,var(--blue-1),var(--blue-2) 55%,var(--blue-3));
  --focus: 0 0 0 2px var(--black),0 0 0 4px var(--blue-2);
  --shadow-soft: 0 4px 18px -6px rgba(0,0,0,.6), 0 0 0 1px #ffffff10 inset;
  --transition: 180ms cubic-bezier(.4,.2,.2,1);
  --role-header-h: 2.6rem; /* hauteur uniforme header rôle */
}

* { box-sizing:border-box; }
html,body { height:100%; }
body.theme-academic {
  min-height:100vh;
  margin:0;
  font-family: var(--sans);
  background:radial-gradient(circle at 30% 25%, #0d1722 0%, #081019 55%, #05070b 100%) fixed;
  color: var(--white);
  overflow-x:hidden;
}

/* Motifs géométriques de fond */
.bg-triangles { position:fixed; inset:0; pointer-events:none; z-index:-1; background:
  repeating-linear-gradient(60deg, #ffffff03 0 12px, transparent 12px 24px),
  radial-gradient(circle at 80% 15%, #00b4d80e, transparent 60%),
  radial-gradient(circle at 15% 75%, #48cae40d, transparent 65%);
  mask: linear-gradient(to bottom, #000 40%, transparent 100%);
}

header { text-align:center; padding: clamp(1.3rem,3vw,3rem) 1rem 1.2rem; position:relative; }
.brand-cluster { display:flex; flex-direction:column; align-items:center; gap: .65rem; }
header h1 { margin:0; font-family: var(--serif); font-weight:600; font-size: clamp(2rem,5vw,3.4rem); letter-spacing:.5px; position:relative; line-height:1.1; }
header h1 .serif { font-style:italic; background:var(--gradient-blue); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 14px #0077b644; }
.subtitle { margin:0; font-size:.9rem; letter-spacing:.8px; opacity:.78; font-family: var(--mono); background:linear-gradient(90deg,#48cae4 0,#0077B6 70%); -webkit-background-clip:text; background-clip:text; color:transparent; }

/* Emblème / lauriers */
.crest { position:relative; width:86px; aspect-ratio:1; background:linear-gradient(140deg,#0d1d29,#081018); border:1px solid #ffffff12; border-radius:18px; display:flex; align-items:center; justify-content:center; box-shadow: var(--shadow-soft); }
.crest:before, .crest:after { content:""; position:absolute; inset:0; border-radius:inherit; background:linear-gradient(190deg,#ffffff12,#ffffff03); mix-blend-mode:overlay; pointer-events:none; }
.crest-inner { position:relative; display:flex; align-items:center; justify-content:center; gap:.4rem; }
.crest-icon { font-size:1.65rem; filter:drop-shadow(0 2px 4px #000); }
.laurel { width:20px; height:44px; background:conic-gradient(from 90deg at 50% 50%, #48cae4 0 25%, #00b4d8 25% 50%, #0077b6 50% 75%, #48cae4 75% 100%); -webkit-mask:radial-gradient(circle at 50% 0, #000 35%, transparent 36%), radial-gradient(circle at 50% 25%, #000 35%, transparent 36%) 0 16px/100% 16px repeat-y; mask:radial-gradient(circle at 50% 0, #000 35%, transparent 36%), radial-gradient(circle at 50% 25%, #000 35%, transparent 36%) 0 16px/100% 16px repeat-y; opacity:.85; }
.laurel.left { transform:scaleX(-1) rotate(-6deg); }
.laurel.right { transform:rotate(6deg); }

main { max-width:1220px; margin:0 auto; padding:0 1.2rem 3.5rem; }

/* Cartes rôles */
.roles-container { display:grid; gap:1.2rem; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); margin-bottom:2.4rem; }
.role-card { position:relative; background:linear-gradient(160deg,#0f1f2a,#0b141c 60%, #091016); border:1px solid #ffffff14; border-radius: var(--radius); padding:1rem 1.1rem 1.3rem; box-shadow: var(--shadow-soft); overflow:hidden; isolation:isolate; display:flex; flex-direction:column; }
.role-card:before { content:""; position:absolute; inset:0; background:linear-gradient(120deg,#ffffff0a,#ffffff02); mix-blend-mode:overlay; pointer-events:none; }
.role-card h3 { margin:0; display:flex; align-items:center; gap:.55rem; font: 500 1rem var(--sans); letter-spacing:.6px; text-transform:uppercase; min-height:var(--role-header-h); line-height:1.1; }
.role-pill { font-size:.55rem; letter-spacing:1.2px; font-weight:700; padding:.3rem .55rem; background:#ffffff12; border-radius:999px; color:var(--blue-3); box-shadow:0 0 0 1px #ffffff18 inset; }
.role-name { margin-top:.15rem; font-size:1.45rem; font-family: var(--serif); font-weight:600; text-align:center; background:#121e28; border:1px solid #ffffff12; border-radius:14px; padding:.65rem .8rem; min-height:2.3rem; display:flex; align-items:center; justify-content:center; letter-spacing:.5px; position:relative; }
.role-name.spin { animation: pop .6s ease; }
@keyframes pop { 0% { transform:translateY(6px) scale(.9); opacity:0;} 55% { transform:translateY(-3px) scale(1.04); opacity:1;} 100% { transform:translateY(0) scale(1);} }

/* Roulette tri-slot */
.role-name.rolling { padding:0; background:#101a22; }
.role-roller { position:relative; height:2.8rem; display:flex; flex-direction:column; justify-content:center; overflow:hidden; }
.role-roller-line { position:relative; display:flex; flex-direction:column; }
.role-slot { height:.9rem; display:flex; align-items:center; justify-content:center; font-size:.65rem; opacity:.45; font-family:var(--mono); letter-spacing:.5px; }
.role-slot.current { font-size:1.1rem; height:1.2rem; font-weight:600; opacity:1; font-family:var(--serif); }

/* Exclusions */
.exclusions-panel { background: linear-gradient(160deg,#0f1f2a,#0a1219 70%, #070c11); border:1px solid #ffffff12; border-radius: var(--radius); padding:1.4rem 1.3rem 1.7rem; box-shadow: var(--shadow-soft); }
.section-title { margin:0 0 .7rem; font-size:1.3rem; letter-spacing:.6px; }
.hint { margin:.1rem 0 1.1rem; font-size:.7rem; letter-spacing:.8px; opacity:.65; font-family:var(--mono); }
.exclusions-grid { display:grid; gap:.9rem; grid-template-columns:repeat(auto-fit,minmax(210px,1fr)); }
.ex-block { background:#101c25; border:1px solid #ffffff12; border-radius:15px; padding:.8rem .85rem 1rem; display:flex; flex-direction:column; gap:.55rem; box-shadow:0 3px 10px -4px #000; }
.ex-block h4 { margin:0; font:600 .78rem var(--sans); letter-spacing:1px; text-transform:uppercase; color:var(--blue-3); display:flex; justify-content:space-between; }
.member-list { list-style:none; margin:0; padding:0; display:grid; gap:.4rem; }
.member-list li { position:relative; }
.member-list input { position:absolute; opacity:0; }
.member-list label { display:flex; align-items:center; gap:.55rem; font-size:.7rem; cursor:pointer; background:#ffffff08; padding:.45rem .55rem; border-radius:8px; letter-spacing:.4px; transition:var(--transition); font-family:var(--mono); }
.member-list input:focus-visible + label { outline:var(--focus); }
.member-list input:checked + label { background:var(--blue-2); color:#03161c; font-weight:600; box-shadow:0 0 0 1px #ffffff10 inset; }
.member-list input:not(:checked):hover + label { background:#ffffff14; }

.global-exclusions { display:flex; flex-wrap:wrap; gap:.55rem; margin:0 0 1.1rem; }
.global-exclusions .ge-item { position:relative; }
.global-exclusions input { position:absolute; opacity:0; }
.global-exclusions label { cursor:pointer; background:#ffffff0f; padding:.5rem .85rem; border-radius:40px; font-size:.65rem; letter-spacing:.8px; display:flex; align-items:center; gap:.6ch; font-family:var(--mono); box-shadow:0 0 0 1px #ffffff14 inset; transition:var(--transition); }
.global-exclusions input:checked + label { background:linear-gradient(90deg,var(--blue-1),var(--blue-3)); color:#fff; font-weight:600; box-shadow:0 0 0 1px #ffffff22 inset; }
.global-exclusions input:not(:checked):hover + label { background:#ffffff18; }
.global-exclusions .tag { background:#0009; padding:.2rem .55rem; border-radius:12px; font-size:.55rem; letter-spacing:1px; font-family:var(--sans); }

/* Actions */
.actions { margin-top:2.2rem; }
.control-bar { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; align-items:stretch; }
.ctrl { background:#0f1620; border:1px solid #1d2a36; border-radius:16px; padding:.85rem .9rem 1rem; position:relative; display:flex; flex-direction:column; gap:.55rem; box-shadow:0 4px 14px -6px #000, 0 0 0 1px #ffffff08 inset; backdrop-filter:blur(4px); }
.ctrl .divider { height:1px; background:linear-gradient(90deg,#ffffff06,#ffffff18,#ffffff06); margin:.4rem 0 .2rem; border-radius:1px; }
.ctrl label { font:600 .7rem var(--mono); letter-spacing:1px; text-transform:uppercase; display:flex; flex-direction:column; gap:.15rem; }
.ctrl select, .ctrl input[type=range] { width:100%; }
.ctrl select { background:#101c25; border:1px solid #22313f; color:#e7f7ff; padding:.55rem .7rem; border-radius:10px; font:500 .7rem var(--mono); letter-spacing:.6px; }
.ctrl select:focus { outline:none; box-shadow:0 0 0 2px #000,0 0 0 4px #00b4d8; }
.small-label { font:600 .6rem var(--mono); letter-spacing:1px; text-transform:uppercase; opacity:.75; }
.history-controls.inline { display:flex; gap:.4rem; flex-wrap:wrap; }
.btn-mini { background:#14202b; border:1px solid #1f2e3a; color:#d9f3ff; font:600 .6rem var(--mono); letter-spacing:.9px; padding:.45rem .65rem; border-radius:8px; cursor:pointer; transition:var(--transition); display:inline-flex; align-items:center; gap:.35rem; line-height:1; position:relative; }
.btn-mini:hover { background:#1d2c39; border-color:#2b3e50; }
.btn-mini:active { transform:translateY(1px); }
.btn-mini.danger { background:#2a1216; border-color:#4b1c24; color:#ff6b7f; }
.btn-mini.danger:hover { background:#3a1820; border-color:#6a2632; }
.btn-mini.wide { width:100%; justify-content:center; }
.btn-mini:focus-visible { outline:2px solid #00b4d8; outline-offset:2px; }
.btn-mini.accent { background:#102c33; border-color:#1d4d58; color:#5ee6ff; }
.btn-mini.accent:hover { background:#15414b; border-color:#256978; color:#bff6ff; }
.btn-mini.accent:active { transform:translateY(1px); }
.history-controls.inline.expanded { flex-direction:column; align-items:stretch; }
.btn-mini.big { font-size:.62rem; padding:.65rem .8rem; justify-content:center; }
@media (min-width:620px){ .history-controls.inline.expanded { flex-direction:row; flex-wrap:wrap; } .btn-mini.big { flex:1 1 140px; } }
@media (max-width:480px){ .btn-mini.big { font-size:.55rem; padding:.55rem .6rem; } }

/* Responsive */
@media (max-width:750px){
  .roles-container { grid-template-columns:repeat(auto-fit,minmax(170px,1fr)); gap:.85rem; }
  .role-card { padding:.85rem .75rem 1.05rem; }
  .role-card h3 { font-size:.9rem; }
  .role-name { font-size:1.25rem; }
  .exclusions-grid { grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); }
  header h1 { font-size: clamp(1.9rem,7vw,2.6rem); }
  .crest { width:70px; }
  .global-exclusions label { font-size:.6rem; padding:.45rem .7rem; }
  :root { --role-header-h: 3rem; }
  .control-bar { grid-template-columns:1fr 1fr; }
  .ctrl { padding:.7rem .75rem .85rem; }
  .mode-desc { font-size:.5rem; }
  .btn-reset { font-size:.55rem; padding:.55rem .6rem; }
}
@media (min-width:1400px){
  main { max-width:1340px; }
  .roles-container { grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); }
}

/* Utilitaires */
.serif { font-family: var(--serif); }
.mono { font-family: var(--mono); }

::-webkit-scrollbar { width:10px; }
::-webkit-scrollbar-track { background:#06090d; }
::-webkit-scrollbar-thumb { background:#16222b; border-radius:50px; }
::-webkit-scrollbar-thumb:hover { background:#1e2d38; }

.ex-actions { margin-top:1.2rem; padding-top:1rem; border-top:1px solid #ffffff14; display:flex; justify-content:flex-end; }
.mode-row { margin-top:.4rem; }
.mode-row select { background:#101c25; border:1px solid #ffffff22; color:#fff; padding:.5rem .8rem; border-radius:10px; font:500 .75rem var(--mono); letter-spacing:.6px; cursor:pointer; min-width:180px; }
.mode-row select:focus { outline:none; box-shadow: var(--focus); }
.stats-bar { margin-top:.6rem; font:500 .6rem var(--mono); letter-spacing:.8px; display:flex; flex-wrap:wrap; gap:.4rem; justify-content:center; }
.stats-chip { background:#0f1f2a; border:1px solid #ffffff14; padding:.35rem .55rem; border-radius:8px; display:flex; align-items:center; gap:.35rem; }
.stats-chip.bad { border-color:#ff3d5a88; color:#ff667b; }
.stats-chip.good { border-color:#48e1a588; color:#48e1a5; }
.stats-chip span { font-weight:600; }
.mode-desc { margin-top:.45rem; font:500 .6rem var(--mono); letter-spacing:.8px; background:#0f1f2a; border:1px solid #ffffff14; padding:.55rem .7rem; border-radius:10px; color:#cfe9f7; max-width:420px; }

.history-controls { display:flex; gap:.6rem; margin-top:.4rem; }
.btn-mini { background:#14202b; border:1px solid #1f2e3a; color:#d9f3ff; font:600 .6rem var(--mono); letter-spacing:.9px; padding:.45rem .65rem; border-radius:8px; cursor:pointer; transition:var(--transition); display:inline-flex; align-items:center; gap:.35rem; line-height:1; position:relative; }
.btn-mini:hover { background:#1d2c39; border-color:#2b3e50; }
.btn-mini:active { transform:translateY(1px); }
.btn-mini.danger { background:#2a1216; border-color:#4b1c24; color:#ff6b7f; }
.btn-mini.danger:hover { background:#3a1820; border-color:#6a2632; }
.btn-mini.wide { width:100%; justify-content:center; }
.btn-mini:focus-visible { outline:2px solid #00b4d8; outline-offset:2px; }
.btn-mini.accent { background:#102c33; border-color:#1d4d58; color:#5ee6ff; }
.btn-mini.accent:hover { background:#15414b; border-color:#256978; color:#bff6ff; }
.btn-mini.accent:active { transform:translateY(1px); }

/* Confetti */
#confettiLayer { position:fixed; inset:0; pointer-events:none; z-index:999; }
.confetti-piece { position:absolute; width:10px; height:14px; top:-20px; opacity:0; animation: fall linear forwards; will-change: transform; }
@keyframes fall { to { transform: translateY(110vh) rotate(var(--rotEnd)); opacity:1; } }

/* Draw / Reset buttons */
.draw-btn { font:600 .7rem var(--mono); letter-spacing:1px; text-transform:uppercase; padding:.55rem .75rem; border-radius:10px; cursor:pointer; transition:var(--transition); position:relative; display:inline-flex; align-items:center; justify-content:center; gap:.4rem; }
.draw-btn:after { content:""; position:absolute; inset:0; border-radius:inherit; background:linear-gradient(135deg,#0077b6,#00b4d8 55%,#48cae4); opacity:.6; transition:var(--transition); }
.draw-btn:hover { background:#0077b6; }
.draw-btn:active { transform:translateY(1px); }
.draw-btn.full { width:100%; position:relative; --glow:#00b4d8; background:linear-gradient(135deg,#0077b6,#00b4d8 55%,#48cae4); border:1px solid #49c7e680; }
.draw-btn.full:after { content:""; position:absolute; inset:0; background:radial-gradient(circle at 30% 30%, #ffffff22, transparent 70%); opacity:0; transition:var(--transition); mix-blend-mode:overlay; }
.draw-btn.full:hover:after { opacity:1; }
.draw-btn.full:hover { box-shadow:0 0 0 1px #49c7e640 inset,0 8px 28px -6px #008ac9,0 0 20px -4px #00b4d866; }
.draw-btn.full:active { transform:translateY(2px); }
.btn-reset { margin-top:.55rem; background:#18242e; border:1px solid #253644; color:#9fc6d9; font:600 .6rem var(--mono); letter-spacing:.9px; padding:.6rem .8rem; border-radius:10px; cursor:pointer; transition:var(--transition); width:100%; display:flex; align-items:center; justify-content:center; gap:.5rem; }
.btn-reset:hover { background:#20313c; color:#cfe9f7; }
.btn-reset:active { transform:translateY(1px); }
.btn-reset:focus-visible { outline:2px solid #00b4d8; outline-offset:3px; }

.exclusions-panel .ex-actions { margin-top:1rem; display:flex; justify-content:flex-end; }
.exclusions-panel #resetExclusions { background:#231f2e; border:1px solid #3a324b; color:#d8c9ff; font:600 .6rem var(--mono); letter-spacing:1px; padding:.6rem 1.1rem; border-radius:12px; cursor:pointer; transition:var(--transition); text-transform:uppercase; }
.exclusions-panel #resetExclusions:hover { background:#2d2740; border-color:#4c3f61; color:#f1e9ff; }
.exclusions-panel #resetExclusions:active { transform:translateY(1px); }
.exclusions-panel #resetExclusions:focus-visible { outline:2px solid #8f44fd; outline-offset:3px; }
.draw-ctrl .message-wrapper { width:100%; display:flex; justify-content:center; align-items:center; min-height:2.4rem; }
.message { display:inline-flex; align-items:center; justify-content:center; text-align:center; padding:.25rem .4rem; background:transparent; border:none; min-width:0; font-weight:500; }

#animDurationInput { width:100px; background:linear-gradient(145deg,#0f1c25,#132733); border:1px solid #244050; color:#e6f8ff; padding:.55rem .6rem; padding-right:1.2rem; padding-left:.7rem; border-radius:12px; font:600 .7rem var(--mono); text-align:left; letter-spacing:.5px; box-shadow:0 2px 4px -2px #000 inset,0 0 0 1px #ffffff05 inset; transition:.25s ease; }
.duration-inline { display:flex; align-items:center; gap:.25rem; margin-top:.4rem; }
.duration-inline .unit { background:transparent; border:none; padding:0; margin-left:.1rem; font:600 .7rem var(--mono); letter-spacing:.5px; color:#b7d9e6; line-height:1; align-self:center; }
